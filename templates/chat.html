{% extends 'nav.html' %}
{% block title %}Chat with {{ friend.name }}{% endblock %}
{% block body %}

<style>
    /* Main Chat Container */
    .chat-wrapper {
        width: 100%;
        max-width: 850px;
        margin: auto;
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        height: calc(100vh - 150px);
    }

    /* Chat Header */
    .chat-header {
        background: #0D1C2E;
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        font-size: 1.4rem;
        font-weight: bold;
        letter-spacing: 1px;
    }

    /* Chat Box */
    .chat-box {
        flex-grow: 1;
        background: #f1f1f1;
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
        scroll-behavior: smooth;
    }

    /* Message Bubbles */
    .msg-left, .msg-right {
        max-width: 75%;
        padding: 10px 15px;
        border-radius: 15px;
        position: relative;
        font-size: 1rem;
        line-height: 1.4;
    }

    .msg-right {
        background: #00A878;
        color: white;
        align-self: flex-end;
        border-bottom-right-radius: 0;
    }

    .msg-left {
        background: white;
        color: #0D1C2E;
        align-self: flex-start;
        border-bottom-left-radius: 0;
    }

    /* Time under message */
    .msg-time {
        font-size: 0.75rem;
        opacity: 0.7;
        margin-top: 3px;
    }

    .msg-right .msg-time {
        text-align: right;
        color: #f1f1f1;
    }

    .msg-left .msg-time {
        text-align: left;
        color: #555;
    }

    /* Message Input Section */
    .chat-input-area {
        margin-top: 15px;
        display: flex;
        gap: 10px;
        background: white;
        padding: 12px;
        border-radius: 10px;
        box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
    }

    .chat-input-area input {
        flex-grow: 1;
        border-radius: 10px;
        border: 1px solid #ccc;
        padding: 12px;
        font-size: 1rem;
    }

    .chat-input-area button {
        background: #0D1C2E;
        border: none;
        color: white;
        padding: 12px 25px;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.2s;
        font-size: 1rem;
    }

    .chat-input-area button:hover {
        background: #00A878;
        transform: translateY(-2px);
    }

    /* Responsiveness */
    @media (max-width: 768px) {
        .chat-wrapper {
            width: 95%;
            height: calc(100vh - 160px);
        }
        .msg-left, .msg-right {
            max-width: 90%;
        }
    }

    @media (max-width: 480px) {
        .chat-header {
            font-size: 1.2rem;
        }
        .chat-input-area button {
            padding: 10px 18px;
        }
    }
</style>

<div class="chat-wrapper">

    <!-- Chat Header -->
    <div class="chat-header">
        Chat with {{ friend.name }}
    </div>

    <!-- Chat Messages -->
    <div class="chat-box" id="chatBox">
        {% for m in chat %}
            {% if m.SENDER.id == me.id %}
                <!-- Right (My Message) -->
                <div class="msg-right">
                    {{ m.chat }}
                    <div class="msg-time">{{ m.time }}</div>
                </div>
            {% else %}
                <!-- Left (Friend Message) -->
                <div class="msg-left">
                    {{ m.chat }}
                    <div class="msg-time">{{ m.time }}</div>
                </div>
            {% endif %}
        {% endfor %}
    </div>

    <!-- Message Input -->
    <form method="POST" action="/message/{{ friend.id }}/" class="chat-input-area">
        {% csrf_token %}
        <input type="text" name="message" placeholder="Type your message..." required>
        <button type="submit">Send</button>
    </form>

</div>

<!-- Auto scroll to bottom -->
<script>
    const chatBox = document.getElementById("chatBox");
    chatBox.scrollTop = chatBox.scrollHeight;
</script>

{% endblock %}